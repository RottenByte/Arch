#
#
# Everything here is for my own use, be careful if you don't know what you are doing.
#
# This is for a UEFI install only.
#
#

# Lists Disks
lsblk

# Wipe Disk Assuming /dev/nvme0n1 is the target disk
gdisk /dev/nvme0n1
x
z
y
y

# Create Partitions Assuming /dev/nvme0n1 is the target disk - 128M Efi System Partition - Remainder as ext4
cfdisk /dev/nvme0n1

# Create ESP filesystem (Assuming /dev/nvme0n1p1 is the target)
mkfs.vfat -F32 /dev/nvme0n1p1

# Format root filesystem as ext4 (Assuming /dev/nvme0n1p2 is the target)
mkfs.ext4 /dev/nvme0n1p2

# Mount Needed Partitions (Assuming /dev/nvme0n1 is the target disk)
mount /dev/nvme0n1p2 /mnt
mkdir -p /mnt/efi
mount -o noatime /dev/nvme0n1p1 /mnt/efi

# Install as usual
pacstrap /mnt base base-devel grub-efi-x86_64 efibootmgr os-prober intel-ucode linux linux-headers linux-firmware bash-completion wpa_supplicant iwd dialog usbutils nvme-cli nano htop git networkmanager ttf-dejavu ttf-opensans ttf-liberation plasma-desktop plasma-wayland-session kwayland-integration kwayland-server kde-gtk-config kdeplasma-addons kmenuedit kscreen kscreenlocker kwallet-pam libkscreen plasma-nm plasma-pa powerdevil ssdm-kcm systemsettings dolphin dolphin-plugins kwalletmanager konsole yakuake kdenetwork-filesharing kdegraphics-thumbnailers ffmpegthumbs kcalc samba gufw bluedevil bluez bluez-utils

# Create fstab
genfstab -pU /mnt >> /mnt/etc/fstab

# Chroot
arch-chroot /mnt /bin/bash

# Grub install
grub-install --target=x86_64-efi --efi-directory=/efi --bootloader-id=GRUB
# Generate grub.cfg
grub-mkconfig -o /boot/grub/grub.cfg
# Check efi entries
efibootmgr

# Set Locale to en_GB.UTF-8 + Time + Hwclock
nano /etc/locale.gen
# uncomment en_GB.UTF-8 + en_US.UTF-8
locale-gen
echo LANG=en_GB.UTF-8 > /etc/locale.conf
export LANG=en_GB.UTF-8
ls /usr/share/zoneinfo/
ln -sf /usr/share/zoneinfo/GB > /etc/localtime
hwclock --systohc

# Set Hostname (hostnamehere is the hostname)
echo hostnamehere > /etc/hostname

# Enable ILoveCandy + Colour support in pacman
nano /etc/pacman.conf
# uncomment "#Color"
# add "ILoveCandy" in the misc options part on a new line below "#VerbosePkgLists"

# Enable multilib for 32bit applications
nano /etc/pacman.conf
# uncomment "#[multilib]"
# uncomment "#Include = /etc/pacman.d/mirrorlist"
pacman -Syu

# Setup Users (username is the user, change to the name that is required)
passwd
useradd -m -g users -G wheel -s /bin/bash username
passwd username

# setup sudo for group "wheel" using the root password - must use "EDITOR=nano visudo" command
EDITOR=nano visudo
# Search for "#%wheel ALL=(ALL) ALL" and uncomment that line and add this line "Defaults rootpw" below so it looks like the following
----------------------------------
%wheel ALL=(ALL) ALL
Defaults rootpw
----------------------------------

# Enable Services
systemctl enable fstrim.timer
systemctl enable sddm
systemctl enable NetworkManager
systemctl enable ufw
systemctl enable bluetooth

# Exit chroot
exit

# Reboot + Remove Arch USB
reboot

# Install yay
git clone https://aur.archlinux.org/yay.git
cd yay
makepkg -si

# Rank Mirrors
yay -S reflector
sudo reflector -c GB

# Install Useful Packages
yay -S chromium pepper-flash chromium-widevine vlc telegram-desktop gpart mtools f2fs-tools ntfs-3g exfatprogs dosfstools udftools jdk-openjdk

# Optimize makepkg
yay -S pigz pbzip2
nano /etc/makepkg.conf
# update the following compression flags for multithreading
MAKEFLAGS="-j$(nproc)"
COMPRESSGZ=(pigz -c -f -n)
COMPRESSBZ2=(pbzip2 -c -f)
COMPRESSXZ=(xz -c -z - --threads=0)
COMPRESSZST=(zstd -c -z -q - --threads=0)

# Create /swapfile + Set Swappiness
dd if=/dev/zero of=/swapfile bs=1M count=8192 status=progress
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
nano /etc/fstab
/swapfile none swap defaults 0 0
nano /etc/sysctl.d/99-swappiness.conf
vm.swappiness=10

# Verify Microcode Update
dmesg | grep microcode

# Reboot
sudo reboot

#
#
# Install Complete
#
#

# Install android packages
yay -S libmtp android-udev android-tools multilib-devel ccache maven gradle gcc repo gnupg gperf sdl wxgtk2 squashfs-tools curl ncurses zlib schedtool perl-switch zip unzip libxslt bc rsync ccache lib32-zlib lib32-ncurses lib32-readline ncurses5-compat-libs lib32-ncurses5-compat-libs lib32-gcc-libs gnupg flex bison gperf sdl wxgtk2 squashfs-tools curl ncurses zlib schedtool perl-switch libxslt python2-virtualenv bc rsync lib32-zlib lib32-ncurses lib32-readline xml2 lzop pngcrush imagemagick
# Add user to uucp group for mtp support (username is the user, change to the name that is required)
sudo gpasswd -a username uucp

# Setup systemd-swap
yay -S systemd-swap
# Edit Swapfile Config
nano /etc/systemd/swap.conf
"swapfc_enabled=1"
"swapfc_force_preallocated=1"
# Enable systemd-swap
systemctl enable systemd-swap

#
#
# Stuff
#
#

# Full Colour Range
xrandr --output HDMI-3 --set "Broadcast RGB" "Full"

# Trim
fstrim -v /
fstrim -v /boot

# Show CPU Freq
watch -n 0 grep \"cpu MHz\" /proc/cpuinfo

# Nuke GnuPG
sudo rm -fr /etc/pacman.d/gnupg
sudo pacman-key --init
sudo pacman-key --populate archlinux
sudo pacman-key --refresh-keys
sudo pacman -Syu

